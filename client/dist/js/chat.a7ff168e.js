(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chat"],{"293a":function(t,e,c){"use strict";c.r(e);var a=c("7a23"),n={key:0,class:"kaiwa"},o={class:"kaiwa-img-right"},i={class:"kaiwa-text-left"},s={class:"kaiwa-text"};function h(t,e,c,h,l,u){return Object(a["t"])(),Object(a["g"])("div",null,[Object(a["j"])(a["c"],{name:"fade"},{default:Object(a["K"])((function(){return[l.chatShow?(Object(a["t"])(),Object(a["g"])("div",n,[Object(a["j"])("figure",o,[Object(a["j"])("img",{src:l.avatar,alt:"no-img2"},null,8,["src"])]),Object(a["j"])("div",i,[Object(a["j"])("p",s,Object(a["F"])(l.chat||"..."),1)])])):Object(a["h"])("",!0)]})),_:1})])}c("99af");var l=c("8055"),u=c.n(l),r={name:"chat",components:{},data:function(){return{chat:"",chatList:[],chatShow:!1,chatShowTimer:null,socket:null,isSpeech:!1,avatar:"https://i.loli.net/2021/08/01/SFHndyel1UJx6wL.png",cloudSel:"googleNiang",appkey:"",AccessToken:"",voice:"xiaoyun"}},computed:{},watch:{},methods:{playVoice:function(t){var e=this;if(this.isSpeech){var c="";switch(this.cloudSel){case"aliyun":c="https://nls-gateway.cn-shanghai.aliyuncs.com/stream/v1/tts?appkey=".concat(this.appkey,"&token=").concat(this.AccessToken,"&text=").concat(encodeURI(this.chat),"&format=mp3&sample_rate=16000&voice=").concat(this.voice);break;case"googleNiang":c=t;break;case"googleCloud":c=t;break;case"azure":c=t;break;default:break}if(c){var a=new Audio(c);a.load(),a.play().then((function(){})).catch((function(){setTimeout((function(){e.playNextChat()}),300*e.chat.length)})),a.onended=function(){e.playNextChat()}}else setTimeout((function(){e.playNextChat()}),300*this.chat.length)}else setTimeout((function(){e.playNextChat()}),300*this.chat.length)},say:function(t,e){var c=this;this.chat=t,this.$nextTick((function(){c.chatShow=!0,c.playVoice(e)})),clearTimeout(this.chatShowTimer),this.chatShowTimer=setTimeout((function(){c.chatShow=!1}),1e3*this.chat.length)},addChat:function(t){var e=!1;0===this.chatList.length&&(e=!0),this.chatList.push(t),e&&this.playNextChat(!0)},removeChat:function(){this.chatList.length>0&&this.chatList.shift()},playNextChat:function(t){t||this.removeChat();var e=this.chatList[0];e&&this.say(e.chat,e.voiceUrl)},toSocket:function(){var t=this;this.socket=u.a.connect("/socketchat"),this.socket.on("msg",(function(e){var c={chat:e.message,voiceUrl:e.voiceUrl};t.addChat(c),console.log(e)})),this.socket.on("getSettingData",(function(e){console.log(e),t.isSpeech=!!e.isSpeech,t.avatar=e.avatar||"https://i.loli.net/2021/08/01/SFHndyel1UJx6wL.png",t.cloudSel=e.cloudSel||"googleNiang",t.appkey=e.appkey||"",t.AccessToken=e.AccessToken||"",t.voice=e.voice||"xiaoyun"})),this.socket.on("connect",(function(){console.log("已连接")})),this.socket.on("disconnect",(function(){console.log("已断开")}))}},created:function(){this.toSocket()},mounted:function(){},beforeCreate:function(){},beforeMount:function(){},beforeUpdate:function(){},updated:function(){},beforeUnmount:function(){this.socket.close()},unmounted:function(){},activated:function(){}},f=(c("68c7"),c("6b0d")),p=c.n(f);const d=p()(r,[["render",h]]);e["default"]=d},"68c7":function(t,e,c){"use strict";c("f73a")},f73a:function(t,e,c){}}]);
//# sourceMappingURL=chat.a7ff168e.js.map